<!DOCTYPE HTML>
<html lang="en-US" >
    
    <head>
        
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=11; IE=10; IE=9; IE=8; IE=7; IE=EDGE" />
        <title>常见问题 | GTK+ 3 Chinese Reference Manual</title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="generator" content="GitBook 1.4.2">
        <meta name="HandheldFriendly" content="true"/>
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
        <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">
        
        
    
    
    <link rel="next" href="../content/chap-drawing-model.html" />
    
    
    <link rel="prev" href="../content/gtk-resources.html" />
    

        
    </head>
    <body>
        
        
<link rel="stylesheet" href="../gitbook/style.css">


        
    <div class="book" data-level="3" data-basepath=".." data-revision="1421832919627">
    

<div class="book-summary">
    <div class="book-search">
        <input type="text" placeholder="Type to search" class="form-control" />
    </div>
    <ul class="summary">
        
    	
    	
    	

        

        
    
        
        <li class="chapter " data-level="0" data-path="index.html">
            
                
                    <a href="../index.html">
                        <i class="fa fa-check"></i>
                        
                         Introduction
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="1" data-path="content/README.html">
            
                
                    <a href="../content/README.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.</b>
                        
                         GTK+ 概览
                    </a>
                
            
            
            <ul class="articles">
                
    
        
        <li class="chapter " data-level="1.1" data-path="content/gtk+.html">
            
                
                    <a href="../content/gtk+.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.1.</b>
                        
                         开始使用GTK+
                    </a>
                
            
            
            <ul class="articles">
                
    
        
        <li class="chapter " data-level="1.1.1" data-path="content/basic.html">
            
                
                    <a href="../content/basic.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.1.1.</b>
                        
                         基础
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="1.1.2" data-path="content/packing.html">
            
                
                    <a href="../content/packing.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.1.2.</b>
                        
                         填充
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="1.1.3" data-path="content/drawing.html">
            
                
                    <a href="../content/drawing.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.1.3.</b>
                        
                         绘制
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="1.1.4" data-path="content/building_ui.html">
            
                
                    <a href="../content/building_ui.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.1.4.</b>
                        
                         构建用户界面
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="1.1.5" data-path="content/building_app.html">
            
                
                    <a href="../content/building_app.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.1.5.</b>
                        
                         构建应用程序
                    </a>
                
            
            
            <ul class="articles">
                
    
        
        <li class="chapter " data-level="1.1.5.1" data-path="content/building_app/asmallapp.html">
            
                
                    <a href="../content/building_app/asmallapp.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.1.5.1.</b>
                        
                         一个小应用
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="1.1.5.2" data-path="content/building_app/paddingwindow.html">
            
                
                    <a href="../content/building_app/paddingwindow.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.1.5.2.</b>
                        
                         填充窗口
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="1.1.5.3" data-path="content/building_app/openfile.html">
            
                
                    <a href="../content/building_app/openfile.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.1.5.3.</b>
                        
                         打开文件
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="1.1.5.4" data-path="content/building_app/amenu.html">
            
                
                    <a href="../content/building_app/amenu.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.1.5.4.</b>
                        
                         一个应用菜单
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="1.1.5.5" data-path="content/building_app/dialog.html">
            
                
                    <a href="../content/building_app/dialog.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.1.5.5.</b>
                        
                         一个偏好对话框
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="1.1.5.6" data-path="content/building_app/searchbar.html">
            
                
                    <a href="../content/building_app/searchbar.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.1.5.6.</b>
                        
                         增加搜索条
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="1.1.5.7" data-path="content/building_app/sidebar.html">
            
                
                    <a href="../content/building_app/sidebar.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.1.5.7.</b>
                        
                         增加侧边栏
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="1.1.5.8" data-path="content/building_app/properties.html">
            
                
                    <a href="../content/building_app/properties.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.1.5.8.</b>
                        
                         属性
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="1.1.5.9" data-path="content/building_app/headerbar.html">
            
                
                    <a href="../content/building_app/headerbar.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.1.5.9.</b>
                        
                         标题栏
                    </a>
                
            
            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        
        <li class="chapter " data-level="2" data-path="content/gtk-resources.html">
            
                
                    <a href="../content/gtk-resources.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.</b>
                        
                         邮件列表和bug报告
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter active" data-level="3" data-path="content/gtk-questing-index.html">
            
                
                    <a href="../content/gtk-questing-index.html">
                        <i class="fa fa-check"></i>
                        
                            <b>3.</b>
                        
                         常见问题
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="4" data-path="content/chap-drawing-model.html">
            
                
                    <a href="../content/chap-drawing-model.html">
                        <i class="fa fa-check"></i>
                        
                            <b>4.</b>
                        
                         GTK+ 绘图模型
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="5" data-path="content/chap-input-handing.html">
            
                
                    <a href="../content/chap-input-handing.html">
                        <i class="fa fa-check"></i>
                        
                            <b>5.</b>
                        
                         GTK+ 输入处理模型
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="6" data-path="content/AppExample/index.html">
            
                
                    <a href="../content/AppExample/index.html">
                        <i class="fa fa-check"></i>
                        
                            <b>6.</b>
                        
                         GTK+ 小程序范例
                    </a>
                
            
            
        </li>
    


        
        <li class="divider"></li>
        <li>
            <a href="http://www.gitbook.io/" target="blank" class="gitbook-link">Published using GitBook</a>
        </li>
        
    </ul>
</div>

    <div class="book-body">
        <div class="body-inner">
            <div class="book-header">
    <!-- Actions Left -->
    <a href="#" class="btn pull-left toggle-summary" aria-label="Toggle summary"><i class="fa fa-align-justify"></i></a>
    <a href="#" class="btn pull-left toggle-search" aria-label="Toggle search"><i class="fa fa-search"></i></a>
    
    <div id="font-settings-wrapper" class="dropdown pull-left">
        <a href="#" class="btn toggle-dropdown" aria-label="Toggle font settings"><i class="fa fa-font"></i>
        </a>
        <div class="dropdown-menu font-settings">
    <div class="dropdown-caret">
        <span class="caret-outer"></span>
        <span class="caret-inner"></span>
    </div>

    <div class="buttons">
        <button type="button" id="reduce-font-size" class="button size-2">A</button>
        <button type="button" id="enlarge-font-size" class="button size-2">A</button>
    </div>

    <div class="buttons font-family-list">
        <button type="button" data-font="0" class="button">Serif</button>
        <button type="button" data-font="1" class="button">Sans</button>
    </div>

    <div class="buttons color-theme-list">
        <button type="button" id="color-theme-preview-0" class="button size-3" data-theme="0">White</button>
        <button type="button" id="color-theme-preview-1" class="button size-3" data-theme="1">Sepia</button>
        <button type="button" id="color-theme-preview-2" class="button size-3" data-theme="2">Night</button>
    </div>
</div>

    </div>

    <!-- Actions Right -->
    
    <div class="dropdown pull-right">
        <a href="#" class="btn toggle-dropdown" aria-label="Toggle share dropdown"><i class="fa fa-share-alt"></i>
        </a>
        <div class="dropdown-menu font-settings dropdown-left">
            <div class="dropdown-caret">
                <span class="caret-outer"></span>
                <span class="caret-inner"></span>
            </div>
            <div class="buttons">
                <button type="button" data-sharing="twitter" class="button">Twitter</button>
                <button type="button" data-sharing="google-plus" class="button">Google</button>
                <button type="button" data-sharing="facebook" class="button">Facebook</button>
                <button type="button" data-sharing="weibo" class="button">Weibo</button>
                <button type="button" data-sharing="instapaper" class="button">Instapaper</button>
            </div>
        </div>
    </div>
    

    
    <a href="#" target="_blank" class="btn pull-right google-plus-sharing-link sharing-link" data-sharing="google-plus" aria-label="Share on Google Plus"><i class="fa fa-google-plus"></i></a>
    
    
    <a href="#" target="_blank" class="btn pull-right facebook-sharing-link sharing-link" data-sharing="facebook" aria-label="Share on Facebook"><i class="fa fa-facebook"></i></a>
    
    
    <a href="#" target="_blank" class="btn pull-right twitter-sharing-link sharing-link" data-sharing="twitter" aria-label="Share on Twitter"><i class="fa fa-twitter"></i></a>
    
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../" >GTK+ 3 Chinese Reference Manual</a>
    </h1>
</div>

            <div class="page-wrapper" tabindex="-1">
                <div class="page-inner">
                
                
                    <section class="normal" id="section-gitbook_20">
                    
                        <h2 id="">常见问题</h2>
<p>常见问题——寻找GTK+手册中常见问题的答案</p>
<h2 id="">问题和答案</h2>
<p>这是一个用常见“How do I...“组织的参考手册”索引“。如果你不确定去读哪个手册来解决你的问题，这个列表是个开始的好地方。</p>
<h5 id="">常规</h5>
<h3 id="11">1.1</h3>
<p><strong>我如何在GTK+上起步？</strong></p>
<p>GTK+<a href="www.gtk.org">网站</a>提供了一些<a href="www.gtk.org/documentation.php">教程</a>和其他文档（大部分是关于GTK+ 2.x的，但大部分依然可用）。更多的从文本资源到在线书籍可以在<a href="https:/developer.gnome.org" target="_blank">GNOME developer&#39;s site</a>中找到。在学习这些材料后，你应该准备回到这个索引来了解细节。</p>
<h3 id="12">1.2</h3>
<p><strong>我可以在哪里得到GTK+的帮助，提交bug报告或者制作一个特性请求？</strong></p>
<p>参阅<a href="gtk-resources.html">此文档顶部</a></p>
<h3 id="13">1.3</h3>
<p><strong>我如何从一个GTK+版本迁移到另一个？</strong></p>
<p>参阅<a href="https://developer.gnome.org/gtk3/3.14/gtk-migrating-2-to-3.html" target="_blank">Migrating from GTK+2.x to GTK+ 3</a>。你也许能在这个文档里得到关于某些部件和函数的有用信息。
如果你有一个手册里所没涵盖的问题，请在邮件列表上提问然后对于文档在<a href="https://bugzilla.gnome.org" target="_blank">提交一个bug报告</a>。</p>
<h3 id="14">1.4</h3>
<p><strong>GTK+中的内存管理如何工作？程序返回时我是否要释放数据？</strong></p>
<p>查看<a href="https://developer.gnome.org/gobject/unstable/gobject-The-Base-Object-Type.html#GObject" target="_blank">GObject</a>和<a href="https://developer.gnome.org/gobject/unstable/gobject-The-Base-Object-Type.html#GInitiallyUnowned" target="_blank">GInitiallyUnowned</a>文档。对于GObject特别主义g_object_ref()和g_object_unref()。GInitiallyUnowned是GObject的子类，所以同样注意，特别对于有&quot;floating“状态的（相应文档中有解释）。
对于函数返回的strings，如果不应该被释放它们要被声明为&quot;const&quot;。非&quot;const&quot;的strings应该被g_free()释放。Arrays遵从同样的规则。如果你发现一个没被记录的特别是规则，请向<a href="http://bugzilla.gnome.org" target="_blank">http://bugzilla.gnome.org</a>提交bug。</p>
<h3 id="15">1.5</h3>
<p><strong>当我在创建部件后立即销毁了它，为什么我的程序还会泄露内存？</strong></p>
<p>如果GtkFoo 不是个顶层窗体，然后</p>
<pre><code class="lang-c">foo = gtk_foo_new();
gtk_widget_destroy(foo);
</code></pre>
<p>是一个内存泄露，因为没有东西假定首次浮动引用，如果你正在使用一个部件而且你没有立即将它填充进一个容器，然后你想要正常的引用计数，而不是浮动引用计数。</p>
<p>为了做到这些，你必须获得一个部件的参考并且在创建它之后丢弃引用参考（&quot;ref and sink&quot;in GTK+ parlance）。</p>
<pre><code class="lang-c">foo = gtk_foo_new ();
g_object_ref_sink (foo);
</code></pre>
<p>当你想要丢弃部件，你必须在丢弃引用前调用<code>gtk_widget_destroy()</code>来破坏部件的任何外部连接</p>
<pre><code class="lang-c">gtk_widget_destroy (foo);
g_object_unref (foo);
</code></pre>
<p>当你立即向容器添加一个部件，它安排假设一个首次浮动引用所以你不必担心引用计数……只要调用<code>gtk_widget_destroy()</code>丢弃该部件即可。</p>
<h3 id="16">1.6</h3>
<p><strong>我该如何在GTK+中使用线程？</strong></p>
<p>这在GDK线程文档中有说明。也可参看<a href="https://developer.gnome.org/glib/unstable/glib-Threads.html" target="_blank">GThread</a>文档的便携线程原型。</p>
<h3 id="17">1.7</h3>
<p><strong>我该如何国际化一个GTK+程序？</strong></p>
<p>大多数人使用<a href="www.gnu.org/software/gettext/">GNU gettext</a>，它在安装GLib时被要求。在一个已安装gettext的UNIX或者Linux系统，键入info gettext阅读文档。</p>
<p>使用gettext的简短清单：调用bindtextdomain()所以gettext能找到包括译文的文件，调用textdomain()来设定默认翻译区域，调用bind_textdomain_codeset()来要求所有已翻译的字符串以UTF-8返回，然后调用gettext()来查找每个字符并翻译为默认区域文字。</p>
<p>gi18n.h提供了以下简略的宏。按照惯例，人们定义了以下的宏。</p>
<pre><code class="lang-c"><span class="hljs-preprocessor">#<span class="hljs-keyword">define</span> _(x)        gettext (x)</span>
<span class="hljs-preprocessor">#<span class="hljs-keyword">define</span> N_(x)        x</span>
<span class="hljs-preprocessor">#<span class="hljs-keyword">define</span> C_(ctx,x)    pgettext(ctx, x)</span>
</code></pre>
<p>用<code>N_()</code>（没有操作数）在译文中标记一个字符串，字符串所在的位置不允许调用gettext()，比如在一个数组初始化程序中。你最终必须在字符串上调用gettext()来获取译文。<code>_()</code>标记了译文的字符串并且实际上翻译了它。<code>C_()</code>宏向标记的译文增加一个额外的上下文(context)，这可以消除了短字符串在程序的不同部分需要不同翻译而产生的歧义。</p>
<p>使用完这些宏的代码如下：</p>
<pre><code class="lang-c"><span class="hljs-preprocessor">#<span class="hljs-keyword">include</span> &lt;gi18n.h&gt;</span>
<span class="hljs-keyword">static</span> <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *global_variable = N_(<span class="hljs-string">"Translate this string"</span>);

<span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span>
make_widgets (<span class="hljs-keyword">void</span>)
{
    GtkWidget *label1;
    GtkWidget *label2;

    label1 = gtk_label_new (_(<span class="hljs-string">"Another string to translate"</span>));
    label2 = gtk_label_new (_(global_variable));
...
</code></pre>
<p>库应该使用dgettext()而不是gettext()，gettext()允许每次翻译时指定翻译区域。库也应该避免调用textdomain()，因为它会指定区域而不是使用默认的区域。</p>
<p>按照宏GETTEXT_PACKAGE被定义去控制你的库的翻译区域的惯例，gi18n-lib.h可以被包括来提供以下便利：</p>
<pre><code class="lang-c"><span class="hljs-preprocessor">#<span class="hljs-keyword">define</span> _(x) dgettext (GETTEXT_PACKAGE, x)</span>
</code></pre>
<h3 id="18">1.8</h3>
<p><strong>我该如何在GTK+程序中使用noo_ASCII字符？</strong></p>
<p>GTK+对文本使用Unicode（更确切的说是UTF-8），UTF-8把每个Unicode值译成1到6个字节，而且有一些能使在C程序中使用Unicode文本是个不错选择的良好特性：</p>
<ul>
<li>ASCII 字符被译为相近的ASCII码值</li>
<li>ASCII 字符不会作为其他字符的一部分出现</li>
<li>零字节不会作为一个字符的一部分出现，所以UTF-8字符串可以被常见的c库函数用来控制零结尾字符串</li>
</ul>
<p>更多关于Unicode和UTF-8的信息可以在<a href="www.cl.cam.ac.uk/~mgk25/unicode.html">UTF-8 and Unicode FAQ for Unix/Linux</a>，Glib提供UTF-8和其他编码间字符串转换的函数，参看<a href="https://developer.gnome.org/glib/unstale/glib-Character-Set-Conversion.html#g-locale-to-utf8" target="_blank">g_locale_to_utf8</a>和<a href="https://developer.gnome.org/glib/unstable/glib-Charater-Set-Conversion.html#g_convert" target="_blank">g_convert()</a>。</p>
<p>外部来源的文本（比如文件或者用户输入)，在被传递给GTK+前必须被转换为UTF-8。下面的例子将一个ISO-8859-1编码的文本内容写出到标准输出：</p>
<pre><code class="lang-c">gchar *text, *utf8_text;
gsize length;
GError *error = NULL;

<span class="hljs-keyword">if</span> (g_file_get_contents (filename, &amp;text, &amp;length, NULL))
  {
     utf8_text = g_convert (text, length, <span class="hljs-string">"UTF-8"</span>, <span class="hljs-string">"ISO-8859-1"</span>,
                            NULL, NULL, &amp;error);
     <span class="hljs-keyword">if</span> (error != NULL)
       {
         <span class="hljs-built_in">fprintf</span> (<span class="hljs-string">"Couldn't convert file %s to UTF-8\n"</span>, filename);
         g_error_free (error);
       }
     <span class="hljs-keyword">else</span>
       g_print (utf8_text);
  }
<span class="hljs-keyword">else</span>
  <span class="hljs-built_in">fprintf</span> (stderr, <span class="hljs-string">"Unable to read file %s\n"</span>, filename);
</code></pre>
<p>对于源码中的字符串，这里有几个对待non-ASCII内容的方案：</p>
<ul>
<li>直接用UTF-8</li>
<li>逃离UTF-8</li>
<li>运行时转换</li>
</ul>
<p>这里有一个范例显示了三种使用版权标志&amp;copy 的方法，该标志有Unicode和ISO-8859-1码值169和在UTF-8中被替代为194,169两个字节，或者作为字符串的&quot;\302\251&quot;。</p>
<pre><code class="lang-c">g_print (<span class="hljs-string">"direct UTF-8: ©"</span>);
g_print (<span class="hljs-string">"escaped UTF-8: \302\251"</span>);
text = g_convert (<span class="hljs-string">"runtime conversion: ©"</span>, -<span class="hljs-number">1</span>, <span class="hljs-string">"ISO-8859-1"</span>, <span class="hljs-string">"UTF-8"</span>, NULL, NULL, NULL);
g_print(text);
g_free (text);
</code></pre>
<p>如果你使用gettext()本地化你的应用程序，你必须调用bind_textdomain_codeset()来确定被翻译字符串以UTF-8返回。</p>
<h3 id="19">1.9</h3>
<p><strong>我该如何在GTK+中使用C++？</strong></p>
<p>有两个方法来实现它。GTK+头文件使用了C的子集它也兼容C++，所以你可以在C++程序中使用正常的GTK+ API。另外，你可以使用一个&quot;C++版本&quot;比如提供原生C++ API的<a href="gtkmm.sourceforge.net">gtkmm</a>。</p>
<p>当直接使用GTK+时，注意只有函数可以和信号连接，不是方法。所以你必须使用全局函数或者&quot;静态&quot;类函数来连接信号。</p>
<p>另外一个直接使用GTK+常见的问题是C++不会隐含的把一个整型转换为枚举。当使用位域(bitfields)时会发生以上情况；在C中你可以写以下代码：</p>
<pre><code class="lang-c">gdk_window_set_events (gdk_window,
                        GDK_BUTTON_PRESS_MASK | GDK_BUTTON_RELEASE_MASK);
</code></pre>
<p>在C++中必须写：</p>
<pre><code>gdk_window_set_events (gdk_window,
                        (GdkEventMask) GDK_BUTTON_PRESS_MASK | GDK_BUTTON_RELEASE_MASK);
</code></pre><p>然而，很少有函数需要这个。</p>
<h3 id="110">1.10</h3>
<p><strong>我该如何在GTK+中使用其他non_C languages？</strong></p>
<p>参看<a href="www.gtk.org/language-bindings.php">list of language bindings</a>和<a href="http://www.gtk.org" target="_blank">http://www.gtk.org</a>。</p>
<h3 id="111">1.11</h3>
<p><strong>我该如何从从文件中加载一副图片或者动画？</strong></p>
<p>用gtk_image_new_from_file()来将一个图片文件直接载入显示部件。用gdk_pixbuf_new_from_file()载入另外目的的图片。用gdk_pixbuf_animation_new_from_file()载入动画。gdk_pixbuf_animation_new_from_file也可以载入非动画图片，将它与gdk_pixbuf_animation_is_static_image()结合使用可以载如未知类型文件。</p>
<p>用GdkPixbufLoader异步载入一个图片或者动画文件（非堵塞）。</p>
<h3 id="112">1.12</h3>
<p><strong>我该如何绘制文字？</strong></p>
<p>绘制文字，你可以使用Pango layout和pango_cairo_show_layout()。</p>
<pre><code class="lang-c">layout = gtk_widget_create_pango_layout (widget, text);
fontdesc = pango_font_description_from_string (<span class="hljs-string">"Luxi Mono 12"</span>);
pango_layout_set_font_description (layout, fontdesc);
pango_cairo_show_layout (cr, layout);
pango_font_description_free (fontdesc);
g_object_unref (layout);
</code></pre>
<h3 id="113">1.13</h3>
<p><strong>我该如何测量一段文字的大小？</strong></p>
<p>为了掌握一段文字的大小，你可以使用Pango layout和pango_layout_get_pixel_size()，向下面这样使用代码：</p>
<pre><code class="lang-c">layout = gtk_widget_create_pango_layout (widget, text);
fontdesc = pango_font_description_from_string (<span class="hljs-string">"Luxi Mono 12"</span>);
pango_layout_set_font_description (layout, fontdesc);
pango_layout_get_pixel_size (layout, &amp;width, &amp;height);
pango_font_description_free (fontdesc);
g_object_unref (layout);
</code></pre>
<h3 id="114">1.14</h3>
<p><strong>为什么当我用GTK_TYPE_BLAH 宏时，类型没注册？</strong></p>
<p>GTK_TYPE_BLAH 宏被定义就像调用 gtk_lah_get_type()，_get_type()函数被描述为当它的值为被使用时允许编译器优化调用（call away）的G_GUNC_CONST。</p>
<p>这个问题的通常应变方法是在一个易变变量里储存结果，它使编译器优化调用。</p>
<pre><code class="lang-c"><span class="hljs-keyword">volatile</span> GType dummy = GTK_TYPE_BLAH;
</code></pre>
<h3 id="115">1.15</h3>
<p><strong>我该如何创建一个透明的顶层窗口？</strong></p>
<p>使一个窗体透明需要用一个支持透明的视觉资料。它通过使用gdk_screen_get_rgba_visaul()得到屏幕的RGBA视频资料并且将它设置在窗体上。<strong>注意</strong>如果屏幕不支持透明窗口gdk_screen_get_rgba_visaul()会返回NULL，你应该退回到gdk_screen_get_rgba_visaul()。另外，<strong>注意</strong>从一个屏幕移到另一个屏幕，它会改变，所以不管什么时候窗体被移动到另一个窗体它需要被重复。</p>
<pre><code class="lang-c">GdkVisual *visual;

visual = gdk_screen_get_rgba_visual (screen);
<span class="hljs-keyword">if</span> (visual == NULL)
    visual = gdk_screen_get_system_visual (screen);
gtk_widget_set_visual (GTK_WIDGET (window), visual);
</code></pre>
<p>简单的使用cairos RGBA绘制属性来填充窗体的alpha通道。</p>
<p><strong>注意</strong>一个RGBA视觉资料的出现并不保证窗体会透明出现在屏幕上。在X11上，它需要一个正在运行的复合管理(compositing manager)。参见gtk_widget_is_composited()寻找alpha通道是否被支持。 </p>
<h5 id="">我该用哪个部件……</h5>
<h3 id="21">2.1</h3>
<p><strong>对于列表和树？</strong></p>
<p>参看<a href="https://developer.gnome.org/gtk3/3.14/TreeWidget.html" target="_blank">tree widget overview</a>——你应该使用<a href="https://developer.gnome.org/gtk3/3.14/GtkTreeView.html" target="_blank">GtkTreeView</a>。（列表是个没有分支的树，所以树部件对于列表同样有用）。</p>
<h3 id="22">2.2</h3>
<p><strong>对于多行文本显示和编辑？</strong></p>
<p>参看<a href="https://developer.gnome.org/gtk3/3.14/TextWidget.html" target="_blank">text widget overview</a>，你应该使用<a href="https://developer.gnome.org/gtk3/3.14/GtkTextView.html" target="_blank">GtkTextView</a>。</p>
<p>如果你只有少量的文本，<code>GtkLabel</code>当然更合适。可以用<code>gtk_label_set_selectable()</code>来使它可选。对于单行文本输入，见<a href="https://developer.gnome.org/gtk3/3.14/GtkEntry" target="_blank">GtkEntry</a>。</p>
<h3 id="23">2.3</h3>
<p><strong>为了显示一张图像或者动画？</strong></p>
<p><code>GtkImage</code>仅能显示GTK+能理解的格式的图像。如果你需要做更复杂的事，比如在图像上绘制文本或者图形，可以用<code>GtkDrawingArea</code>。</p>
<h3 id="24">2.4</h3>
<p><strong>对于呈现一个互斥选项的集合，在窗口哪里用<code>combo box</code>？</strong></p>
<p>对于这种情况，建议用<code>GtkComboBox</code>部件。这个部件看起来像combo box或current option menu，取决于当前主题。如果你需要一个可编辑文本，用<code>has-entry</code>属性。</p>
<h5 id="gtkwidget">GtkWidget</h5>
<h3 id="31">3.1</h3>
<p><strong>我如何改变部件的颜色？</strong></p>
<p>参看<code>gtk_widget_override_color()</code>和<code>gtk_widget_override_background_color()</code>。你可以通过安装一个自定义style provider来改变部件外观。参看<code>gtk_style_context_and_provider()。</code></p>
<p>改变部件的背景颜色比如没有背景的<code>GtkLabel</code>，可以把他们放在<code>GtkEventBox</code>中然后设置event box的背景。</p>
<h3 id="32">3.2</h3>
<p><strong>我该如何改变部件的字体?</strong></p>
<p>这有几个可行的答案，它们取决于你具体想实现的。一个选择是<code>gtk_widget_override_font()</code>。</p>
<pre><code class="lang-c">PangofontDesc *font_desc = pango_font_description_new ();
pango_font_description_set_size (font_desc, <span class="hljs-number">40</span>);
gtk_widget_override_font (widget, font);
pango_font_description_free (font_desc);
</code></pre>
<p>如果你想使文本更大，可以使用<code>gtk_label_set_markup()</code>：</p>
<pre><code class="lang-c">gtk_label_set_markup (label, <span class="hljs-string">"&lt;big&gt;big text&lt;/big&gt;"</span>);
</code></pre>
<p>它更适合许多应用程序，因为它对于用户字体尺寸选择是个相对的尺寸，参看<code>g_markup_escape_text()</code>，如果你想灵活的构建。
你也可以用以下方法来改变部件字体</p>
<pre><code>.my-widget-class {
    font: Sans 30;
}
</code></pre><p>在CSS文件中，通过<code>gtk_css_provider_load_from_file()</code>加载它，用<code>gtk_style_context_add_provider_for_screen()</code>添加provider。用<code>gtk_style_context_add_class</code>在<code>GtkStyleContext</code>设定style class，可以将style信息和你的控件联系在一起。这个方法的优点是你可以重新覆盖你选择的字体。参见<code>GtkStyleContext</code>了解更多。</p>
<h3 id="33">3.3</h3>
<p><strong>我该如何禁用一个部件？</strong></p>
<p>在GTK+中，一个失效部件被称做&quot;insensitive&quot;参看<code>gtk_widget_set_sentitive()</code>。</p>
<h5 id="gtktextview">GtkTextView</h5>
<h3 id="41">4.1</h3>
<p><strong>我该如何得到输入文本的内容并将它作为string？</strong></p>
<p>参看<code>gtk_text_buffer_get_bounds()</code>和<code>gtk_text_buffer_get_text()</code>或<code>gtk_text_iter_get_text()</code></p>
<pre><code class="lang-c">GtkTextIter start, end;
GtkTextBuffer *buffer;
<span class="hljs-keyword">char</span> *text;

buffer = gtk_text_view_get_buffer (GTK_TEXT_VIEW (text_view));
gtk_text_buffer_get_bounds (buffer, &amp;start, &amp;end);
text = gtk_text_iter_get_text (&amp;start, &amp;end);
<span class="hljs-comment">/*use text*/</span>
g_free (text);
</code></pre>
<h3 id="42">4.2</h3>
<p><strong>我该如何使一个文本部件完全用某种字体显示它的内容？</strong></p>
<p>如果你使用<code>gtk_text_buffer_insert_with_tags()</code>来添加选择字体的tags，输入文本会有想要的表现，但是在tag块前后的用户输入文本会以默认style显示。
为保证所有文本都有想要的表现，用<code>gtk_widget_override_font()</code>来改变部件的默认字体。</p>
<h3 id="43">4.3</h3>
<p><strong>我该如何是text view自动滚动到buffer最后？</strong></p>
<p>一个使text view自动滚到到尾部的好方法是在buffer最后安排一个mark，并且给它一个right gravity。gravity可以影响在mark上输入的文本，使其保持在尾部。
为了确保buffer尾部可见，在输入新文本后用<code>gtk_text_view_scroll_to_mark()</code>滚动到mark。</p>
<h5 id="gtktreeview">GtkTreeView</h5>
<h3 id="51">5.1</h3>
<p><strong>我该如何将一些数据和tree的某一行联系起来？</strong></p>
<p>记住，<code>GtkTreeModel</code>的列不一定得显示出来。所以你可以把非用户可见数据像其他数据一样放在model里，通过<code>gtk_tree_modle_get()</code>取回它，参看<a href="https://developer.gnome.org/gtk3/3.14/TreeWidget.html" target="_blank">tree widget overview</a></p>
<h3 id="52">5.2</h3>
<p><strong>我该如何把图片和文本放进同一列？</strong></p>
<p>你可以用<code>gtk_tree_view_column_pack_start</code>或<code>gtk_tree_view_column_pack_end</code>将不止一个<code>GtkCellRenderer</code>放进单个<code>GtkTreeViewColumn</code>。如此便能把一个<code>GtkCellRendererPixbuf</code>和一个<code>GtkCellRendererText</code>放入一列。</p>
<h3 id="53">5.3</h3>
<p><strong>我能用<code>Gtk_list_store_set()</code>和<code>gtk_tree_store_set()</code>轻松的将数据放在<code>GtkTreeStore</code>/<code>GtkListStore</code>上，但无法读回？</strong></p>
<p><code>GtkTreeStore</code>和<code>GtkListStore</code>都实现<code>GtkTreeModel</code>接口。必然地，你可以使用这个接口实现的任何函数。使用<code>gtk_tree_model_get()</code>读回数据是个好办法。</p>
<h3 id="54">5.4</h3>
<p><strong>我该如何改变由<code>GtkTreeView</code>定义的行列数？</strong></p>
<p>用<code>gtk_tree_view_insert_column_with_data_func()</code>或<code>gtk_tree_column_set_cell_data_func()</code>然后自己做从number到string的转换（比如<code>g_strdup_printf()</code>）。
下面的例子显示了这个方法：</p>
<pre><code class="lang-c"><span class="hljs-keyword">enum</span>
{
  DOUBLE_COLUMN,
  N_COLUMNS
};

GtkListStore *mycolumns;
GtkTreeView *treeview;

<span class="hljs-keyword">void</span>
my_cell_double_to_text (GtkTreeViewColumn *tree_column,
                    GtkCellRenderer   *cell,
                        GtkTreeModel      *tree_model,
                    GtkTreeIter       *iter,
                        gpointer           data)
{
  GtkCellRendererText *cell_text = (GtkCellRendererText *)cell;
  gdouble d;
  gchar *text;

  <span class="hljs-comment">/* Get the double value from the model. */</span>
  gtk_tree_model_get (tree_model, iter, (gint)data, &amp;d, -<span class="hljs-number">1</span>);
  <span class="hljs-comment">/* Now we can format the value ourselves. */</span>
  text = g_strdup_printf (<span class="hljs-string">"%.2f"</span>, d);
  g_object_set (cell, <span class="hljs-string">"text"</span>, text, NULL);
  g_free (text);
}

<span class="hljs-keyword">void</span>
set_up_new_columns (GtkTreeView *myview)
{
  GtkCellRendererText *renderer;
  GtkTreeViewColumn *column;
  GtkListStore *mycolumns;

  <span class="hljs-comment">/* Create the data model and associate it with the given TreeView */</span>
  mycolumns = gtk_list_store_new (N_COLUMNS, G_TYPE_DOUBLE);
  gtk_tree_view_set_model (myview, GTK_TREE_MODEL (mycolumns));

  <span class="hljs-comment">/* Create a GtkCellRendererText */</span>
  renderer = gtk_cell_renderer_text_new ();

  <span class="hljs-comment">/* Create a new column that has a title ("Example column"),
   * uses the above created renderer that will render the double
   * value into text from the associated model's rows.
   */</span>
  column = gtk_tree_view_column_new ();
  gtk_tree_view_column_set_title  (column, <span class="hljs-string">"Example column"</span>);
  renderer = gtk_cell_renderer_text_new ();
  gtk_tree_view_column_pack_start (column, renderer, TRUE);

  <span class="hljs-comment">/* Append the new column after the GtkTreeView's previous columns. */</span>
  gtk_tree_view_append_column (GTK_TREE_VIEW (myview), column);
  <span class="hljs-comment">/* Since we created the column by hand, we can set it up for our
   * needs, e.g. set its minimum and maximum width, etc.
   */</span>
  <span class="hljs-comment">/* Set up a custom function that will be called when the column content
   * is rendered. We use the func_data pointer as an index into our
   * model. This is convenient when using multi column lists.
   */</span>
  gtk_tree_view_column_set_cell_data_func (column, renderer,
                                       my_cell_double_to_text,
                                           (gpointer)DOUBLE_COLUMN, NULL);
}
</code></pre>
<h3 id="55">5.5</h3>
<p><strong>我该如何隐藏我tree view里的expander arrows？</strong></p>
<p>设置tree view这哦姑娘的expander-column属性可以隐藏列。参看<code>gtk_tree_view_set_expander_column()</code>和<code>gtk_tree_view_column_set_visible()</code>。</p>
<h5 id="gtkcairo">GTK+中使用cairo</h5>
<h3 id="61">6.1</h3>
<p><strong>我该如何在GTK+应用程序中使用cairo来绘制？</strong></p>
<p>&quot;<code>draw</code>&quot;信号接受一个准备使用的cairo上下文作为你应该使用的参数。
GTK+中所有的drawing 在draw处理函数中完成，GTK+为双缓冲drawing 创建了一个临时像素图。用<code>gtk_widget_set_double_buffered ()</code>可以容易的关闭双缓冲，但这并不合适，因为会造成一些闪烁。</p>
<h3 id="62">6.2</h3>
<p><strong>我可以通过使用cairo中的Glitz或者GL来提升程序的表现么？</strong></p>
<p>不能。GDK X11后端使用cairo X 后端（其他GDK后端使用它们各自的原生cairo后端）。GTK+开发者相信优化cairo X 后端和使用的X server中的相关代码路径是提升GDK drawing表现最棒的方法（大部分是Render扩展）。</p>
<h3 id="63">6.3</h3>
<p><strong>我可以用cairo在GdkPixbuf上绘制么？</strong></p>
<p>不能.至少现在不行。cairo image surface 不支持GdkPixbuf使用的像素格式。</p>

                    
                    </section>
                
                
                </div>
            </div>
        </div>

        
        <a href="../content/gtk-resources.html" class="navigation navigation-prev " aria-label="Previous page: 邮件列表和bug报告"><i class="fa fa-angle-left"></i></a>
        
        
        <a href="../content/chap-drawing-model.html" class="navigation navigation-next " aria-label="Next page: GTK+ 绘图模型"><i class="fa fa-angle-right"></i></a>
        
    </div>
</div>

        
<script src="../gitbook/app.js"></script>

    
    <script src="https://cdn.mathjax.org/mathjax/2.4-latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-mathjax/plugin.js"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-livereload/plugin.js"></script>
    

<script>
require(["gitbook"], function(gitbook) {
    var config = {"fontSettings":{"theme":null,"family":"sans","size":2}};
    gitbook.start(config);
});
</script>

        
    </body>
    
</html>
