<!DOCTYPE HTML>
<html lang="en-US" manifest="../manifest.appcache">
    
    <head>
        
        <meta charset="UTF-8">
        <title>构建应用程序 | GTK+ 3 Chinese Reference Manual</title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="generator" content="GitBook 0.5.2">
        <meta name="HandheldFriendly" content="true"/>
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">
        
    
    
    
    
    <link rel="prev" href="../content/building_ui.html" />
    

        
    </head>
    <body>
        
        
<link rel="stylesheet" href="../gitbook/style.css">


        
    <div class="book"  data-level="1.1.5" data-basepath=".." data-revision="1418015747731">
    <div class="book-header">
    <!-- Actions Left -->
    <a href="#" class="btn pull-left toggle-summary" aria-label="Toggle summary"><i class="fa fa-align-justify"></i></a>
    
    <a href="https://github.com/null" target="_blank" class="btn pull-left home-bookmark" aria-label="GitHub home"><i class="fa fa-bookmark-o"></i></a>
    
    <a href="#" class="btn pull-left toggle-search" aria-label="Toggle search"><i class="fa fa-search"></i></a>
    <span id="font-settings-wrapper">
        <a href="#" class="btn pull-left toggle-font-settings" aria-label="Toggle font settings"><i class="fa fa-font"></i>
        </a>
        <div class="dropdown-menu font-settings">
    <div class="dropdown-caret">
        <span class="caret-outer"></span>
        <span class="caret-inner"></span>
    </div>

    <div class="btn-group btn-block">
        <button id="reduce-font-size" class="btn btn-default">A</button>
        <button id="enlarge-font-size" class="btn btn-default">A</button>
    </div>

    <ul class="list-group font-family-list">
        <li class="list-group-item" data-font="0">Serif</li>
        <li class="list-group-item" data-font="1">Sans</li>
    </ul>

    <div class="btn-group btn-group-xs btn-block color-theme-list">
        <button type="button" class="btn btn-default" id="color-theme-preview-0" data-theme="0">White</button>
        <button type="button" class="btn btn-default" id="color-theme-preview-1" data-theme="1">Sepia</button>
        <button type="button" class="btn btn-default" id="color-theme-preview-2" data-theme="2">Night</button>
    </div>
</div>

    </span>

    <!-- Actions Right -->
    
    <a href="#" target="_blank" class="btn pull-right google-plus-sharing-link sharing-link" data-sharing="google-plus" aria-label="Share on Google Plus"><i class="fa fa-google-plus"></i></a>
    
    
    <a href="#" target="_blank" class="btn pull-right facebook-sharing-link sharing-link" data-sharing="facebook" aria-label="Share on Facebook"><i class="fa fa-facebook"></i></a>
    
    
    <a href="#" target="_blank" class="btn pull-right twitter-sharing-link sharing-link" data-sharing="twitter" aria-label="Share on Twitter"><i class="fa fa-twitter"></i></a>
    

    

    <!-- Title -->
    <h1>
        <i class="fa fa-spinner fa-spin"></i>
        <a href="../" >GTK+ 3 Chinese Reference Manual</a>
    </h1>
</div>

    

<div class="book-summary">
    <div class="book-search">
        <input type="text" placeholder="Search" class="form-control" />
    </div>
    <ul class="summary">
        
        

        

        

        

        <li data-level="0" data-path="index.html">
            <a href="../"><i class="fa fa-check"></i> Introduction</a>
        </li>
        
    
        <li class="chapter " data-level="1" data-path="content/README.html">
            
            <a href="../content/README.html">
                <i class="fa fa-check"></i> <b>1.</b> GTK+ 概览
            </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.1" data-path="content/gtk+.html">
            
            <a href="../content/gtk+.html">
                <i class="fa fa-check"></i> <b>1.1.</b> 开始使用GTK+
            </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.1.1" data-path="content/basic.html">
            
            <a href="../content/basic.html">
                <i class="fa fa-check"></i> <b>1.1.1.</b> 基础
            </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.1.2" data-path="content/packing.html">
            
            <a href="../content/packing.html">
                <i class="fa fa-check"></i> <b>1.1.2.</b> 填充
            </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.1.3" data-path="content/drawing.html">
            
            <a href="../content/drawing.html">
                <i class="fa fa-check"></i> <b>1.1.3.</b> 绘制
            </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.1.4" data-path="content/building_ui.html">
            
            <a href="../content/building_ui.html">
                <i class="fa fa-check"></i> <b>1.1.4.</b> 构建用户界面
            </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.1.5" data-path="content/building_app.html">
            
            <a href="../content/building_app.html">
                <i class="fa fa-check"></i> <b>1.1.5.</b> 构建应用程序
            </a>
            
            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    


        
        <li class="divider"></li>
        <li>
            <a href="http://www.gitbook.io/" target="blank" class="gitbook-link">Generated using GitBook</a>
        </li>
        
    </ul>
</div>

    <div class="book-body">
        <div class="body-inner">
            <div class="page-wrapper" tabindex="-1">
                <div class="book-progress">
    <div class="bar">
        <div class="inner" style="width: 100%;min-width: 85.71428571428571%;"></div>
    </div>
    <div class="chapters">
    
        <a href="../index.html" title="Introduction" class="chapter done new-chapter" data-progress="0" style="left: 0%;"></a>
    
        <a href="../content/README.html" title="GTK+ 概览" class="chapter done new-chapter" data-progress="1" style="left: 14.285714285714286%;"></a>
    
        <a href="../content/gtk+.html" title="开始使用GTK+" class="chapter done " data-progress="1.1" style="left: 28.571428571428573%;"></a>
    
        <a href="../content/basic.html" title="基础" class="chapter done " data-progress="1.1.1" style="left: 42.857142857142854%;"></a>
    
        <a href="../content/packing.html" title="填充" class="chapter done " data-progress="1.1.2" style="left: 57.142857142857146%;"></a>
    
        <a href="../content/drawing.html" title="绘制" class="chapter done " data-progress="1.1.3" style="left: 71.42857142857143%;"></a>
    
        <a href="../content/building_ui.html" title="构建用户界面" class="chapter done " data-progress="1.1.4" style="left: 85.71428571428571%;"></a>
    
        <a href="../content/building_app.html" title="构建应用程序" class="chapter done " data-progress="1.1.5" style="left: 100%;"></a>
    
    </div>
</div>

                <div class="page-inner">
                
                    <section class="normal" id="section-gitbook_298">
                    
                        <h2 id="-">构建应用程序</h2>
<p>一个普通的应用程序由以下文件组成：</p>
<ul>
<li>二进制文件<blockquote>
<p>这个安装在 <code>/usr/bin</code>。</p>
</blockquote>
</li>
<li>一个桌面文件<blockquote>
<p>这个桌面文件向shell提供关于这个程序的重要信息,例如名称、图标、D-Bus名称，启动的命令行。安装在 <code>/usr/share/applications</code>.</p>
</blockquote>
</li>
<li>一个图标<blockquote>
<p>这个图标安装在 <code>/usr/share/icons/hicolor/48x48/apps</code>, 无论当前背景是什么系统都会到这里查找图标。</p>
</blockquote>
</li>
<li>一个设置框架<blockquote>
<p>如果应用使用了GSettings, 它会将它的schema安装在 <code>/usr/share/glib-2.0/schemas</code>, 这样dconf-editor之类的工具就能够找到它。</p>
</blockquote>
</li>
<li>其他资源<blockquote>
<p>其他文件,例如GtkBuilder ui文件, 最好从应用二进制文件自身储存的资源中加载。如果有需要，许多文件会按照惯例放置在<code>/usr/share</code>。</p>
</blockquote>
</li>
</ul>
<p>GTK+ includes application support that is built on top of GApplication. 在这篇教程中，我们从头开始构建一个简单的应用，然后逐渐一点一点增加功能。在这个过程中, 我们将会了解到 GtkApplication, templates, resources, application menus, settings, GtkHeaderBar, GtkStack, GtkSearchBar, GtkListBox和更多东西。</p>
<p>完整的源文件可以在 GTK+ source distribution的范例根目录下找到，或者可以在GTK+的git仓库在线查看。</p>
<h3 id="-">一个小应用</h3>
<p>当使用GtkApplication，main主函数非常简单。我们仅仅调用了<code>g_application_run()</code> 并给出一个应用范例。</p>
<pre><code class="lang-c"><span class="hljs-preprocessor">#include &lt;gtk/gtk.h&gt;</span>
<span class="hljs-preprocessor">#include &lt;exampleapp.h&gt;</span>

<span class="hljs-keyword">int</span>
main (<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span> *argv[])
{
  <span class="hljs-keyword">return</span> g_application_run (G_APPLICATION (example_app_new ()), argc, argv);
}
</code></pre>
<p>All the application logic is in the application class, which is a subclass of GtkApplication. Our example does not yet have any interesting functionality. All it does is open a window when it is activated without arguments, and open the files it is given, if it is started with arguments.</p>
<p>To handle these two cases, we override the activate() vfunc, which gets called when the application is launched without commandline arguments, and the open() vfunc, which gets called when the application is launched with commandline arguments.</p>
<p>To learn more about GApplication entry points, consult the GIO documentation.</p>
<pre><code class="lang-c"><span class="hljs-preprocessor">#include &lt;gtk/gtk.h&gt;</span>

<span class="hljs-preprocessor">#include "exampleapp.h"</span>
<span class="hljs-preprocessor">#include "exampleappwin.h"</span>

<span class="hljs-keyword">struct</span> _ExampleApp
{
  GtkApplication parent;
};

<span class="hljs-keyword">struct</span> _ExampleAppClass
{
  GtkApplicationClass parent_class;
};

G_DEFINE_TYPE(ExampleApp, example_app, GTK_TYPE_APPLICATION);

<span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span>
example_app_init (ExampleApp *app)
{
}

<span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span>
example_app_activate (GApplication *app)
{
  ExampleAppWindow *win;

  win = example_app_window_new (EXAMPLE_APP (app));
  gtk_window_present (GTK_WINDOW (win));
}

<span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span>
example_app_open (GApplication  *app,
                  GFile        **files,
                  gint           n_files,
                  <span class="hljs-keyword">const</span> gchar   *hint)
{
  GList *windows;
  ExampleAppWindow *win;
  <span class="hljs-keyword">int</span> i;

  windows = gtk_application_get_windows (GTK_APPLICATION (app));
  <span class="hljs-keyword">if</span> (windows)
    win = EXAMPLE_APP_WINDOW (windows-&gt;data);
  <span class="hljs-keyword">else</span>
    win = example_app_window_new (EXAMPLE_APP (app));

  <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; n_files; i++)
    example_app_window_open (win, files[i]);

  gtk_window_present (GTK_WINDOW (win));
}

<span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span>
example_app_class_init (ExampleAppClass *<span class="hljs-keyword">class</span>)
{
  G_APPLICATION_CLASS (<span class="hljs-keyword">class</span>)-&gt;activate = example_app_activate;
  G_APPLICATION_CLASS (<span class="hljs-keyword">class</span>)-&gt;open = example_app_open;
}

ExampleApp *
example_app_new (<span class="hljs-keyword">void</span>)
{
  <span class="hljs-keyword">return</span> g_object_new (EXAMPLE_APP_TYPE,
                       <span class="hljs-string">"application-id"</span>, <span class="hljs-string">"org.gtk.exampleapp"</span>,
                       <span class="hljs-string">"flags"</span>, G_APPLICATION_HANDLES_OPEN,
                       NULL);
}
</code></pre>
<p>Another important class that is part of the application support in GTK+ is GtkApplicationWindow. It is typically subclassed as well. Our subclass does not do anything yet, so we will just get an empty window.</p>
<pre><code class="lang-c"><span class="hljs-preprocessor">#include "exampleapp.h"</span>
<span class="hljs-preprocessor">#include "exampleappwin.h"</span>
<span class="hljs-preprocessor">#include &lt;gtk/gtk.h&gt;</span>

<span class="hljs-keyword">struct</span> _ExampleAppWindow
{
  GtkApplicationWindow parent;
};

<span class="hljs-keyword">struct</span> _ExampleAppWindowClass
{
  GtkApplicationWindowClass parent_class;
};

G_DEFINE_TYPE(ExampleAppWindow, example_app_window, GTK_TYPE_APPLICATION_WINDOW);

<span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span>
example_app_window_init (ExampleAppWindow *app)
{
}

<span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span>
example_app_window_class_init (ExampleAppWindowClass *<span class="hljs-keyword">class</span>)
{
}

ExampleAppWindow *
example_app_window_new (ExampleApp *app)
{
  <span class="hljs-keyword">return</span> g_object_new (EXAMPLE_APP_WINDOW_TYPE, <span class="hljs-string">"application"</span>, app, NULL);
}

<span class="hljs-keyword">void</span>
example_app_window_open (ExampleAppWindow *win,
                         GFile            *file)
{
}
</code></pre>
<p>As part of the initial setup of our application, we also create an icon and a desktop file.</p>
<p>[Desktop Entry]
Type=Application
Name=Example
Icon=exampleapp
StartupNotify=true
Exec=@bindir@/exampleapp
Note that @bindir@ needs to be replaced with the actual path to the binary before this desktop file can be used.</p>
<p>Here is what we&#39;ve achieved so far:</p>
<p>This does not look very impressive yet, but our application is already presenting itself on the session bus, it has single-instance semantics, and it accepts files as commandline arguments.</p>
<p>Populating the window</p>
<p>In this step, we use a GtkBuilder template to associate a GtkBuilder ui file with our application window class.</p>
<p>Our simple ui file puts a GtkHeaderBar on top of a GtkStack widget. The header bar contains a GtkStackSwitcher, which is a standalone widget to show a row of &#39;tabs&#39; for the pages of a GtkStack.</p>
<pre><code class="lang-xml"><span class="hljs-pi">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">interface</span>&gt;</span>
  <span class="hljs-comment">&lt;!-- interface-requires gtk+ 3.8 --&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">template</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"ExampleAppWindow"</span> <span class="hljs-attribute">parent</span>=<span class="hljs-value">"GtkApplicationWindow"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"title"</span> <span class="hljs-attribute">translatable</span>=<span class="hljs-value">"yes"</span>&gt;</span>Example Application<span class="hljs-tag">&lt;/<span class="hljs-title">property</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"default-width"</span>&gt;</span>600<span class="hljs-tag">&lt;/<span class="hljs-title">property</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"default-height"</span>&gt;</span>400<span class="hljs-tag">&lt;/<span class="hljs-title">property</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">child</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">object</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"GtkBox"</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"content_box"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"visible"</span>&gt;</span>True<span class="hljs-tag">&lt;/<span class="hljs-title">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"orientation"</span>&gt;</span>vertical<span class="hljs-tag">&lt;/<span class="hljs-title">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">child</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-title">object</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"GtkHeaderBar"</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"header"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"visible"</span>&gt;</span>True<span class="hljs-tag">&lt;/<span class="hljs-title">property</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">child</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"title"</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-title">object</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"GtkStackSwitcher"</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"tabs"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"visible"</span>&gt;</span>True<span class="hljs-tag">&lt;/<span class="hljs-title">property</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"margin"</span>&gt;</span>6<span class="hljs-tag">&lt;/<span class="hljs-title">property</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"stack"</span>&gt;</span>stack<span class="hljs-tag">&lt;/<span class="hljs-title">property</span>&gt;</span>
              <span class="hljs-tag">&lt;/<span class="hljs-title">object</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-title">child</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-title">object</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">child</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">child</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-title">object</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"GtkStack"</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"stack"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"visible"</span>&gt;</span>True<span class="hljs-tag">&lt;/<span class="hljs-title">property</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-title">object</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">child</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-title">object</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">child</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">template</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">interface</span>&gt;</span>
</code></pre>
<p>To make use of this file in our application, we revisit our GtkApplicationWindow subclass, and call gtk_widget_class_set_template_from_resource() from the class init function to set the ui file as template for this class. We also add a call to gtk_widget_init_template() in the instance init function to instantiate the template for each instance of our class.</p>
<pre><code> ...

static void
example_app_window_init (ExampleAppWindow *win)
{
  gtk_widget_init_template (GTK_WIDGET (win));
}

static void
example_app_window_class_init (ExampleAppWindowClass *class)
{
  gtk_widget_class_set_template_from_resource (GTK_WIDGET_CLASS (class),
                                               &quot;/org/gtk/exampleapp/window.ui&quot;);
}

 ...
</code></pre><p>(full source)</p>
<p>You may have noticed that we used the _from_resource() variant of the function that sets a template. Now we need to use GLib&#39;s resource functionality to include the ui file in the binary. This is commonly done by listing all resources in a .gresource.xml file, such as this:</p>
<pre><code class="lang-xml"><span class="hljs-pi">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">gresources</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">gresource</span> <span class="hljs-attribute">prefix</span>=<span class="hljs-value">"/org/gtk/exampleapp"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">file</span> <span class="hljs-attribute">preprocess</span>=<span class="hljs-value">"xml-stripblanks"</span>&gt;</span>window.ui<span class="hljs-tag">&lt;/<span class="hljs-title">file</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">gresource</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">gresources</span>&gt;</span>
</code></pre>
<p>This file has to be converted into a C source file that will be compiled and linked into the application together with the other source files. To do so, we use the glib-compile-resources utility:</p>
<pre><code>glib-compile-resources exampleapp.gresource.xml --target=resources.c --generate-source
</code></pre><p>Our application now looks like this:</p>
<p>Opening files</p>
<p>In this step, we make our application show the content of all the files that it is given on the commandline.</p>
<p>To this end, we add a private struct to our application window subclass and keep a reference to the GtkStack there. The gtk_widget_class_bind_template_child_private() function arranges things so that after instantiating the template, the stack member of the private struct will point to the widget of the same name from the template.</p>
<pre><code class="lang-c">...

<span class="hljs-keyword">struct</span> _ExampleAppWindowPrivate
{
  GtkWidget *<span class="hljs-built_in">stack</span>;
};

G_DEFINE_TYPE_WITH_PRIVATE(ExampleAppWindow, example_app_window, GTK_TYPE_APPLICATION_WINDOW);

...

<span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span>
example_app_window_class_init (ExampleAppWindowClass *<span class="hljs-keyword">class</span>)
{
  gtk_widget_class_set_template_from_resource (GTK_WIDGET_CLASS (<span class="hljs-keyword">class</span>),
                                               <span class="hljs-string">"/org/gtk/exampleapp/window.ui"</span>);
  gtk_widget_class_bind_template_child_private (GTK_WIDGET_CLASS (<span class="hljs-keyword">class</span>), ExampleAppWindow, <span class="hljs-built_in">stack</span>);
}

...
</code></pre>
<p>(full source)</p>
<p>Now we revisit the example_app_window_open() function that is called for each commandline argument, and construct a GtkTextView that we then add as a page to the stack:</p>
<pre><code class="lang-c">...

<span class="hljs-keyword">void</span>
example_app_window_open (ExampleAppWindow *win,
                         GFile            *file)
{
  ExampleAppWindowPrivate *priv;
  gchar *basename;
  GtkWidget *scrolled, *view;
  gchar *contents;
  gsize length;

  priv = example_app_window_get_instance_private (win);
  basename = g_file_get_basename (file);

  scrolled = gtk_scrolled_window_new (NULL, NULL);
  gtk_widget_show (scrolled);
  gtk_widget_set_hexpand (scrolled, TRUE);
  gtk_widget_set_vexpand (scrolled, TRUE);
  view = gtk_text_view_new ();
  gtk_text_view_set_editable (GTK_TEXT_VIEW (view), FALSE);
  gtk_text_view_set_cursor_visible (GTK_TEXT_VIEW (view), FALSE);
  gtk_widget_show (view);
  gtk_container_add (GTK_CONTAINER (scrolled), view);
  gtk_stack_add_titled (GTK_STACK (priv-&gt;<span class="hljs-built_in">stack</span>), scrolled, basename, basename);

  <span class="hljs-keyword">if</span> (g_file_load_contents (file, NULL, &amp;contents, &amp;length, NULL, NULL))
    {
      GtkTextBuffer *buffer;

      buffer = gtk_text_view_get_buffer (GTK_TEXT_VIEW (view));
      gtk_text_buffer_set_text (buffer, contents, length);
      g_free (contents);
    }

  g_free (basename);
}

...
</code></pre>
<p>(full source)</p>
<p>Note that we did not have to touch the stack switcher at all. It gets all its information from the stack that it belongs to. Here, we are passing the label to show for each file as the last argument to the gtk_stack_add_titled() function.</p>
<p>Our application is beginning to take shape:</p>
<p>An application menu</p>
<p>An application menu is shown by GNOME shell at the top of the screen. It is meant to collect infrequently used actions that affect the whole application.</p>
<p>Just like the window template, we specify our application menu in a ui file, and add it as a resource to our binary.</p>
<pre><code class="lang-xml"><span class="hljs-pi">&lt;?xml version="1.0"?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">interface</span>&gt;</span>
  <span class="hljs-comment">&lt;!-- interface-requires gtk+ 3.0 --&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">menu</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"appmenu"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">section</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">item</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">attribute</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"label"</span> <span class="hljs-attribute">translatable</span>=<span class="hljs-value">"yes"</span>&gt;</span>_Preferences<span class="hljs-tag">&lt;/<span class="hljs-title">attribute</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">attribute</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"action"</span>&gt;</span>app.preferences<span class="hljs-tag">&lt;/<span class="hljs-title">attribute</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-title">item</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">section</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">section</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">item</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">attribute</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"label"</span> <span class="hljs-attribute">translatable</span>=<span class="hljs-value">"yes"</span>&gt;</span>_Quit<span class="hljs-tag">&lt;/<span class="hljs-title">attribute</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">attribute</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"action"</span>&gt;</span>app.quit<span class="hljs-tag">&lt;/<span class="hljs-title">attribute</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-title">item</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">section</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">menu</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">interface</span>&gt;</span>
</code></pre>
<p>To associate the app menu with the application, we have to call gtk_application_set_app_menu(). Since app menus work by activating GActions, we also have to add a suitable set of actions to our application.</p>
<p>Both of these tasks are best done in the startup() vfunc, which is guaranteed to be called once for each primary application instance:</p>
<pre><code class="lang-c">...

<span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span>
preferences_activated (GSimpleAction *action,
                       GVariant      *parameter,
                       gpointer       app)
{
}

<span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span>
quit_activated (GSimpleAction *action,
                GVariant      *parameter,
                gpointer       app)
{
  g_application_quit (G_APPLICATION (app));
}

<span class="hljs-keyword">static</span> GActionEntry app_entries[] =
{
  { <span class="hljs-string">"preferences"</span>, preferences_activated, NULL, NULL, NULL },
  { <span class="hljs-string">"quit"</span>, quit_activated, NULL, NULL, NULL }
};

<span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span>
example_app_startup (GApplication *app)
{
  GtkBuilder *builder;
  GMenuModel *app_menu;
  <span class="hljs-keyword">const</span> gchar *quit_accels[<span class="hljs-number">2</span>] = { <span class="hljs-string">"&lt;Ctrl&gt;Q"</span>, NULL };

  G_APPLICATION_CLASS (example_app_parent_class)-&gt;startup (app);

  g_action_map_add_action_entries (G_ACTION_MAP (app),
                                   app_entries, G_N_ELEMENTS (app_entries),
                                   app);
  gtk_application_set_accels_for_action (GTK_APPLICATION (app),
                                         <span class="hljs-string">"app.quit"</span>,
                                         quit_accels);

  builder = gtk_builder_new_from_resource (<span class="hljs-string">"/org/gtk/exampleapp/app-menu.ui"</span>);
  app_menu = G_MENU_MODEL (gtk_builder_get_object (builder, <span class="hljs-string">"appmenu"</span>));
  gtk_application_set_app_menu (GTK_APPLICATION (app), app_menu);
  g_object_unref (builder);
}

<span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span>
example_app_class_init (ExampleAppClass *<span class="hljs-keyword">class</span>)
{
  G_APPLICATION_CLASS (<span class="hljs-keyword">class</span>)-&gt;startup = example_app_startup;
  ...
}

...
</code></pre>
<p>(full source)</p>
<p>Our preferences menu item does not do anything yet, but the Quit menu item is fully functional. Note that it can also be activated by the usual Ctrl-Q shortcut. The shortcut was added with gtk_application_set_accels_for_action().</p>
<p>The application menu looks like this:</p>
<p>A preference dialog</p>
<p>A typical application will have a some preferences that should be remembered from one run to the next. Even for our simple example application, we may want to change the font that is used for the content.</p>
<p>We are going to use GSettings to store our preferences. GSettings requires a schema that describes our settings:</p>
<pre><code class="lang-xml"><span class="hljs-pi">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">schemalist</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">schema</span> <span class="hljs-attribute">path</span>=<span class="hljs-value">"/org/gtk/exampleapp/"</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"org.gtk.exampleapp"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">key</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"font"</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"s"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">default</span>&gt;</span>'Monospace 12'<span class="hljs-tag">&lt;/<span class="hljs-title">default</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">summary</span>&gt;</span>Font<span class="hljs-tag">&lt;/<span class="hljs-title">summary</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">description</span>&gt;</span>The font to be used for content.<span class="hljs-tag">&lt;/<span class="hljs-title">description</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">key</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">key</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"transition"</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"s"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">choices</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">choice</span> <span class="hljs-attribute">value</span>=<span class="hljs-value">'none'</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">choice</span> <span class="hljs-attribute">value</span>=<span class="hljs-value">'crossfade'</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">choice</span> <span class="hljs-attribute">value</span>=<span class="hljs-value">'slide-left-right'</span>/&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-title">choices</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">default</span>&gt;</span>'none'<span class="hljs-tag">&lt;/<span class="hljs-title">default</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">summary</span>&gt;</span>Transition<span class="hljs-tag">&lt;/<span class="hljs-title">summary</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">description</span>&gt;</span>The transition to use when switching tabs.<span class="hljs-tag">&lt;/<span class="hljs-title">description</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">key</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">schema</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">schemalist</span>&gt;</span>
</code></pre>
<p>Before we can make use of this schema in our application, we need to compile it into the binary form that GSettings expects. GIO provides macros to do this in autotools-based projects.</p>
<p>Next, we need to connect our settings to the widgets that they are supposed to control. One convenient way to do this is to use GSettings bind functionality to bind settings keys to object properties, as we do here for the transition setting.</p>
<pre><code class="lang-c">...

<span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span>
example_app_window_init (ExampleAppWindow *win)
{
  ExampleAppWindowPrivate *priv;

  priv = example_app_window_get_instance_private (win);
  gtk_widget_init_template (GTK_WIDGET (win));
  priv-&gt;settings = g_settings_new (<span class="hljs-string">"org.gtk.exampleapp"</span>);

  g_settings_bind (priv-&gt;settings, <span class="hljs-string">"transition"</span>,
                   priv-&gt;<span class="hljs-built_in">stack</span>, <span class="hljs-string">"transition-type"</span>,
                   G_SETTINGS_BIND_DEFAULT);
}

...
</code></pre>
<p>(full source)</p>
<p>The code to connect the font setting is a little more involved, since there is no simple object property that it corresponds to, so we are not going to go into that here.</p>
<p>At this point, the application will already react if you change one of the settings, e.g. using the gsettings commandline tool. Of course, we expect the application to provide a preference dialog for these. So lets do that now. Our preference dialog will be a subclass of GtkDialog, and we&#39;ll use the same techniques that we&#39;ve already seen: templates, private structs, settings bindings.</p>
<p>Lets start with the template.</p>
<pre><code class="lang-xml"><span class="hljs-pi">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">interface</span>&gt;</span>
  <span class="hljs-comment">&lt;!-- interface-requires gtk+ 3.8 --&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">template</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"ExampleAppPrefs"</span> <span class="hljs-attribute">parent</span>=<span class="hljs-value">"GtkDialog"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"title"</span> <span class="hljs-attribute">translatable</span>=<span class="hljs-value">"yes"</span>&gt;</span>Preferences<span class="hljs-tag">&lt;/<span class="hljs-title">property</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"resizable"</span>&gt;</span>False<span class="hljs-tag">&lt;/<span class="hljs-title">property</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"modal"</span>&gt;</span>True<span class="hljs-tag">&lt;/<span class="hljs-title">property</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">child</span> <span class="hljs-attribute">internal-child</span>=<span class="hljs-value">"vbox"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">object</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"GtkBox"</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"vbox"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">child</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-title">object</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"GtkGrid"</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"grid"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"visible"</span>&gt;</span>True<span class="hljs-tag">&lt;/<span class="hljs-title">property</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"margin"</span>&gt;</span>6<span class="hljs-tag">&lt;/<span class="hljs-title">property</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"row-spacing"</span>&gt;</span>12<span class="hljs-tag">&lt;/<span class="hljs-title">property</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"column-spacing"</span>&gt;</span>6<span class="hljs-tag">&lt;/<span class="hljs-title">property</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">child</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-title">object</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"GtkLabel"</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"fontlabel"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"visible"</span>&gt;</span>True<span class="hljs-tag">&lt;/<span class="hljs-title">property</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"label"</span>&gt;</span>_Font:<span class="hljs-tag">&lt;/<span class="hljs-title">property</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"use-underline"</span>&gt;</span>True<span class="hljs-tag">&lt;/<span class="hljs-title">property</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"mnemonic-widget"</span>&gt;</span>font<span class="hljs-tag">&lt;/<span class="hljs-title">property</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"xalign"</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-title">property</span>&gt;</span>
              <span class="hljs-tag">&lt;/<span class="hljs-title">object</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-title">packing</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"left-attach"</span>&gt;</span>0<span class="hljs-tag">&lt;/<span class="hljs-title">property</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"top-attach"</span>&gt;</span>0<span class="hljs-tag">&lt;/<span class="hljs-title">property</span>&gt;</span>
              <span class="hljs-tag">&lt;/<span class="hljs-title">packing</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-title">child</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">child</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-title">object</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"GtkFontButton"</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"font"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"visible"</span>&gt;</span>True<span class="hljs-tag">&lt;/<span class="hljs-title">property</span>&gt;</span>
              <span class="hljs-tag">&lt;/<span class="hljs-title">object</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-title">packing</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"left-attach"</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-title">property</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"top-attach"</span>&gt;</span>0<span class="hljs-tag">&lt;/<span class="hljs-title">property</span>&gt;</span>
              <span class="hljs-tag">&lt;/<span class="hljs-title">packing</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-title">child</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">child</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-title">object</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"GtkLabel"</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"transitionlabel"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"visible"</span>&gt;</span>True<span class="hljs-tag">&lt;/<span class="hljs-title">property</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"label"</span>&gt;</span>_Transition:<span class="hljs-tag">&lt;/<span class="hljs-title">property</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"use-underline"</span>&gt;</span>True<span class="hljs-tag">&lt;/<span class="hljs-title">property</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"mnemonic-widget"</span>&gt;</span>transition<span class="hljs-tag">&lt;/<span class="hljs-title">property</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"xalign"</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-title">property</span>&gt;</span>
              <span class="hljs-tag">&lt;/<span class="hljs-title">object</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-title">packing</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"left-attach"</span>&gt;</span>0<span class="hljs-tag">&lt;/<span class="hljs-title">property</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"top-attach"</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-title">property</span>&gt;</span>
              <span class="hljs-tag">&lt;/<span class="hljs-title">packing</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-title">child</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">child</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-title">object</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"GtkComboBoxText"</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"transition"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"visible"</span>&gt;</span>True<span class="hljs-tag">&lt;/<span class="hljs-title">property</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">items</span>&gt;</span>
                  <span class="hljs-tag">&lt;<span class="hljs-title">item</span> <span class="hljs-attribute">translatable</span>=<span class="hljs-value">"yes"</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"none"</span>&gt;</span>None<span class="hljs-tag">&lt;/<span class="hljs-title">item</span>&gt;</span>
                  <span class="hljs-tag">&lt;<span class="hljs-title">item</span> <span class="hljs-attribute">translatable</span>=<span class="hljs-value">"yes"</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"crossfade"</span>&gt;</span>Fade<span class="hljs-tag">&lt;/<span class="hljs-title">item</span>&gt;</span>
                  <span class="hljs-tag">&lt;<span class="hljs-title">item</span> <span class="hljs-attribute">translatable</span>=<span class="hljs-value">"yes"</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"slide-left-right"</span>&gt;</span>Slide<span class="hljs-tag">&lt;/<span class="hljs-title">item</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-title">items</span>&gt;</span>
              <span class="hljs-tag">&lt;/<span class="hljs-title">object</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-title">packing</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"left-attach"</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-title">property</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"top-attach"</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-title">property</span>&gt;</span>
              <span class="hljs-tag">&lt;/<span class="hljs-title">packing</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-title">child</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-title">object</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">child</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-title">object</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">child</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">template</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">interface</span>&gt;</span>
</code></pre>
<p>Next comes the dialog subclass.</p>
<pre><code class="lang-c"><span class="hljs-preprocessor">#include &lt;gtk/gtk.h&gt;</span>

<span class="hljs-preprocessor">#include "exampleapp.h"</span>
<span class="hljs-preprocessor">#include "exampleappwin.h"</span>
<span class="hljs-preprocessor">#include "exampleappprefs.h"</span>

<span class="hljs-keyword">struct</span> _ExampleAppPrefs
{
  GtkDialog parent;
};

<span class="hljs-keyword">struct</span> _ExampleAppPrefsClass
{
  GtkDialogClass parent_class;
};

<span class="hljs-keyword">typedef</span> <span class="hljs-keyword">struct</span> _ExampleAppPrefsPrivate ExampleAppPrefsPrivate;

<span class="hljs-keyword">struct</span> _ExampleAppPrefsPrivate
{
  GSettings *settings;
  GtkWidget *font;
  GtkWidget *transition;
};

G_DEFINE_TYPE_WITH_PRIVATE(ExampleAppPrefs, example_app_prefs, GTK_TYPE_DIALOG)

<span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span>
example_app_prefs_init (ExampleAppPrefs *prefs)
{
  ExampleAppPrefsPrivate *priv;

  priv = example_app_prefs_get_instance_private (prefs);
  gtk_widget_init_template (GTK_WIDGET (prefs));
  priv-&gt;settings = g_settings_new (<span class="hljs-string">"org.gtk.exampleapp"</span>);

  g_settings_bind (priv-&gt;settings, <span class="hljs-string">"font"</span>,
                   priv-&gt;font, <span class="hljs-string">"font"</span>,
                   G_SETTINGS_BIND_DEFAULT);
  g_settings_bind (priv-&gt;settings, <span class="hljs-string">"transition"</span>,
                   priv-&gt;transition, <span class="hljs-string">"active-id"</span>,
                   G_SETTINGS_BIND_DEFAULT);
}

<span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span>
example_app_prefs_dispose (GObject *object)
{
  ExampleAppPrefsPrivate *priv;

  priv = example_app_prefs_get_instance_private (EXAMPLE_APP_PREFS (object));
  g_clear_object (&amp;priv-&gt;settings);

  G_OBJECT_CLASS (example_app_prefs_parent_class)-&gt;dispose (object);
}

<span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span>
example_app_prefs_class_init (ExampleAppPrefsClass *<span class="hljs-keyword">class</span>)
{
  G_OBJECT_CLASS (<span class="hljs-keyword">class</span>)-&gt;dispose = example_app_prefs_dispose;

  gtk_widget_class_set_template_from_resource (GTK_WIDGET_CLASS (<span class="hljs-keyword">class</span>),
                                               <span class="hljs-string">"/org/gtk/exampleapp/prefs.ui"</span>);
  gtk_widget_class_bind_template_child_private (GTK_WIDGET_CLASS (<span class="hljs-keyword">class</span>), ExampleAppPrefs, font);
  gtk_widget_class_bind_template_child_private (GTK_WIDGET_CLASS (<span class="hljs-keyword">class</span>), ExampleAppPrefs, transition);
}

ExampleAppPrefs *
example_app_prefs_new (ExampleAppWindow *win)
{
  <span class="hljs-keyword">return</span> g_object_new (EXAMPLE_APP_PREFS_TYPE, <span class="hljs-string">"transient-for"</span>, win, <span class="hljs-string">"use-header-bar"</span>, TRUE, NULL);
}
</code></pre>
<p>Now we revisit the preferences_activated() function in our application class, and make it open a new preference dialog.</p>
<pre><code class="lang-c">...

<span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span>
preferences_activated (GSimpleAction *action,
                       GVariant      *parameter,
                       gpointer       app)
{
  ExampleAppPrefs *prefs;
  GtkWindow *win;

  win = gtk_application_get_active_window (GTK_APPLICATION (app));
  prefs = example_app_prefs_new (EXAMPLE_APP_WINDOW (win));
  gtk_window_present (GTK_WINDOW (prefs));
}

...
</code></pre>
<p>(full source)</p>
<p>After all this work, our application can now show a preference dialog like this:</p>
<p>Adding a search bar</p>
<p>We continue to flesh out the functionality of our application. For now, we add search. GTK+ supports this with GtkSearchEntry and GtkSearchBar. The search bar is a widget that can slide in from the top to present a search entry.</p>
<p>We add a toggle button to the header bar, which can be used to slide out the search bar below the header bar.</p>
<pre><code class="lang-xml"><span class="hljs-pi">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">interface</span>&gt;</span>
  <span class="hljs-comment">&lt;!-- interface-requires gtk+ 3.8 --&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">template</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"ExampleAppWindow"</span> <span class="hljs-attribute">parent</span>=<span class="hljs-value">"GtkApplicationWindow"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"title"</span> <span class="hljs-attribute">translatable</span>=<span class="hljs-value">"yes"</span>&gt;</span>Example Application<span class="hljs-tag">&lt;/<span class="hljs-title">property</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"default-width"</span>&gt;</span>600<span class="hljs-tag">&lt;/<span class="hljs-title">property</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"default-height"</span>&gt;</span>400<span class="hljs-tag">&lt;/<span class="hljs-title">property</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">child</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">object</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"GtkBox"</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"content_box"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"visible"</span>&gt;</span>True<span class="hljs-tag">&lt;/<span class="hljs-title">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"orientation"</span>&gt;</span>vertical<span class="hljs-tag">&lt;/<span class="hljs-title">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">child</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-title">object</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"GtkHeaderBar"</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"header"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"visible"</span>&gt;</span>True<span class="hljs-tag">&lt;/<span class="hljs-title">property</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">child</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"title"</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-title">object</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"GtkStackSwitcher"</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"tabs"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"visible"</span>&gt;</span>True<span class="hljs-tag">&lt;/<span class="hljs-title">property</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"margin"</span>&gt;</span>6<span class="hljs-tag">&lt;/<span class="hljs-title">property</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"stack"</span>&gt;</span>stack<span class="hljs-tag">&lt;/<span class="hljs-title">property</span>&gt;</span>
              <span class="hljs-tag">&lt;/<span class="hljs-title">object</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-title">child</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">child</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-title">object</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"GtkToggleButton"</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"search"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"visible"</span>&gt;</span>True<span class="hljs-tag">&lt;/<span class="hljs-title">property</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"sensitive"</span>&gt;</span>False<span class="hljs-tag">&lt;/<span class="hljs-title">property</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">style</span>&gt;</span><span class="css">
                  &lt;<span class="hljs-tag">class</span> <span class="hljs-tag">name</span>="<span class="hljs-tag">image-button</span>"/&gt;
                </span><span class="hljs-tag">&lt;/<span class="hljs-title">style</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">child</span>&gt;</span>
                  <span class="hljs-tag">&lt;<span class="hljs-title">object</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"GtkImage"</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"search-icon"</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"visible"</span>&gt;</span>True<span class="hljs-tag">&lt;/<span class="hljs-title">property</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"icon-name"</span>&gt;</span>edit-find-symbolic<span class="hljs-tag">&lt;/<span class="hljs-title">property</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"icon-size"</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-title">property</span>&gt;</span>
                  <span class="hljs-tag">&lt;/<span class="hljs-title">object</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-title">child</span>&gt;</span>
              <span class="hljs-tag">&lt;/<span class="hljs-title">object</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-title">packing</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"pack-type"</span>&gt;</span>end<span class="hljs-tag">&lt;/<span class="hljs-title">property</span>&gt;</span>
              <span class="hljs-tag">&lt;/<span class="hljs-title">packing</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-title">child</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-title">object</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">child</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">child</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-title">object</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"GtkSearchBar"</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"searchbar"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"visible"</span>&gt;</span>True<span class="hljs-tag">&lt;/<span class="hljs-title">property</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">child</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-title">object</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"GtkSearchEntry"</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"searchentry"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">signal</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"search-changed"</span> <span class="hljs-attribute">handler</span>=<span class="hljs-value">"search_text_changed"</span>/&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"visible"</span>&gt;</span>True<span class="hljs-tag">&lt;/<span class="hljs-title">property</span>&gt;</span>
              <span class="hljs-tag">&lt;/<span class="hljs-title">object</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-title">child</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-title">object</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">child</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">child</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-title">object</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"GtkStack"</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"stack"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">signal</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"notify::visible-child"</span> <span class="hljs-attribute">handler</span>=<span class="hljs-value">"visible_child_changed"</span>/&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"visible"</span>&gt;</span>True<span class="hljs-tag">&lt;/<span class="hljs-title">property</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-title">object</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">child</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-title">object</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">child</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">template</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">interface</span>&gt;</span>
</code></pre>
<p>Implementing the search needs quite a few code changes that we are not going to completely go over here. The central piece of the search implementation is a signal handler that listens for text changes in the search entry.</p>
<pre><code class="lang-c">...

<span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span>
search_text_changed (GtkEntry         *entry,
                     ExampleAppWindow *win)
{
  ExampleAppWindowPrivate *priv;
  <span class="hljs-keyword">const</span> gchar *text;
  GtkWidget *tab;
  GtkWidget *view;
  GtkTextBuffer *buffer;
  GtkTextIter start, match_start, match_end;

  text = gtk_entry_get_text (entry);

  <span class="hljs-keyword">if</span> (text[<span class="hljs-number">0</span>] == <span class="hljs-string">'\0'</span>)
    <span class="hljs-keyword">return</span>;

  priv = example_app_window_get_instance_private (win);

  tab = gtk_stack_get_visible_child (GTK_STACK (priv-&gt;<span class="hljs-built_in">stack</span>));
  view = gtk_bin_get_child (GTK_BIN (tab));
  buffer = gtk_text_view_get_buffer (GTK_TEXT_VIEW (view));

  <span class="hljs-comment">/* Very simple-minded search implementation */</span>
  gtk_text_buffer_get_start_iter (buffer, &amp;start);
  <span class="hljs-keyword">if</span> (gtk_text_iter_forward_search (&amp;start, text, GTK_TEXT_SEARCH_CASE_INSENSITIVE,
                                    &amp;match_start, &amp;match_end, NULL))
    {
      gtk_text_buffer_select_range (buffer, &amp;match_start, &amp;match_end);
      gtk_text_view_scroll_to_iter (GTK_TEXT_VIEW (view), &amp;match_start,
                                    <span class="hljs-number">0.0</span>, FALSE, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>);
    }
}

<span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span>
example_app_window_init (ExampleAppWindow *win)
{

...

  gtk_widget_class_bind_template_callback (GTK_WIDGET_CLASS (<span class="hljs-keyword">class</span>), search_text_changed);

...

}

...
</code></pre>
<p>(full source)</p>
<p>With the search bar, our application now looks like this:</p>
<p>Adding a side bar</p>
<p>As another piece of functionality, we are adding a sidebar, which demonstrates GtkMenuButton, GtkRevealer and GtkListBox.</p>
<pre><code class="lang-xml"><span class="hljs-pi">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">interface</span>&gt;</span>
  <span class="hljs-comment">&lt;!-- interface-requires gtk+ 3.8 --&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">template</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"ExampleAppWindow"</span> <span class="hljs-attribute">parent</span>=<span class="hljs-value">"GtkApplicationWindow"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"title"</span> <span class="hljs-attribute">translatable</span>=<span class="hljs-value">"yes"</span>&gt;</span>Example Application<span class="hljs-tag">&lt;/<span class="hljs-title">property</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"default-width"</span>&gt;</span>600<span class="hljs-tag">&lt;/<span class="hljs-title">property</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"default-height"</span>&gt;</span>400<span class="hljs-tag">&lt;/<span class="hljs-title">property</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">child</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">object</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"GtkBox"</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"content_box"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"visible"</span>&gt;</span>True<span class="hljs-tag">&lt;/<span class="hljs-title">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"orientation"</span>&gt;</span>vertical<span class="hljs-tag">&lt;/<span class="hljs-title">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">child</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-title">object</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"GtkHeaderBar"</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"header"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"visible"</span>&gt;</span>True<span class="hljs-tag">&lt;/<span class="hljs-title">property</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">child</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"title"</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-title">object</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"GtkStackSwitcher"</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"tabs"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"visible"</span>&gt;</span>True<span class="hljs-tag">&lt;/<span class="hljs-title">property</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"margin"</span>&gt;</span>6<span class="hljs-tag">&lt;/<span class="hljs-title">property</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"stack"</span>&gt;</span>stack<span class="hljs-tag">&lt;/<span class="hljs-title">property</span>&gt;</span>
              <span class="hljs-tag">&lt;/<span class="hljs-title">object</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-title">child</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">child</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-title">object</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"GtkToggleButton"</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"search"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"visible"</span>&gt;</span>True<span class="hljs-tag">&lt;/<span class="hljs-title">property</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"sensitive"</span>&gt;</span>False<span class="hljs-tag">&lt;/<span class="hljs-title">property</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">style</span>&gt;</span><span class="css">
                  &lt;<span class="hljs-tag">class</span> <span class="hljs-tag">name</span>="<span class="hljs-tag">image-button</span>"/&gt;
                </span><span class="hljs-tag">&lt;/<span class="hljs-title">style</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">child</span>&gt;</span>
                  <span class="hljs-tag">&lt;<span class="hljs-title">object</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"GtkImage"</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"search-icon"</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"visible"</span>&gt;</span>True<span class="hljs-tag">&lt;/<span class="hljs-title">property</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"icon-name"</span>&gt;</span>edit-find-symbolic<span class="hljs-tag">&lt;/<span class="hljs-title">property</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"icon-size"</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-title">property</span>&gt;</span>
                  <span class="hljs-tag">&lt;/<span class="hljs-title">object</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-title">child</span>&gt;</span>
              <span class="hljs-tag">&lt;/<span class="hljs-title">object</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-title">packing</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"pack-type"</span>&gt;</span>end<span class="hljs-tag">&lt;/<span class="hljs-title">property</span>&gt;</span>
              <span class="hljs-tag">&lt;/<span class="hljs-title">packing</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-title">child</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">child</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-title">object</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"GtkMenuButton"</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"gears"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"visible"</span>&gt;</span>True<span class="hljs-tag">&lt;/<span class="hljs-title">property</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"direction"</span>&gt;</span>none<span class="hljs-tag">&lt;/<span class="hljs-title">property</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"use-popover"</span>&gt;</span>True<span class="hljs-tag">&lt;/<span class="hljs-title">property</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">style</span>&gt;</span><span class="css">
                  &lt;<span class="hljs-tag">class</span> <span class="hljs-tag">name</span>="<span class="hljs-tag">image-button</span>"/&gt;
                </span><span class="hljs-tag">&lt;/<span class="hljs-title">style</span>&gt;</span>
              <span class="hljs-tag">&lt;/<span class="hljs-title">object</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-title">packing</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"pack-type"</span>&gt;</span>end<span class="hljs-tag">&lt;/<span class="hljs-title">property</span>&gt;</span>
              <span class="hljs-tag">&lt;/<span class="hljs-title">packing</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-title">child</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-title">object</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">child</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">child</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-title">object</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"GtkSearchBar"</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"searchbar"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"visible"</span>&gt;</span>True<span class="hljs-tag">&lt;/<span class="hljs-title">property</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">child</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-title">object</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"GtkSearchEntry"</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"searchentry"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">signal</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"search-changed"</span> <span class="hljs-attribute">handler</span>=<span class="hljs-value">"search_text_changed"</span>/&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"visible"</span>&gt;</span>True<span class="hljs-tag">&lt;/<span class="hljs-title">property</span>&gt;</span>
              <span class="hljs-tag">&lt;/<span class="hljs-title">object</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-title">child</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-title">object</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">child</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">child</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-title">object</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"GtkBox"</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"hbox"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"visible"</span>&gt;</span>True<span class="hljs-tag">&lt;/<span class="hljs-title">property</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">child</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-title">object</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"GtkRevealer"</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"sidebar"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"visible"</span>&gt;</span>True<span class="hljs-tag">&lt;/<span class="hljs-title">property</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"transition-type"</span>&gt;</span>slide-right<span class="hljs-tag">&lt;/<span class="hljs-title">property</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">child</span>&gt;</span>
                 <span class="hljs-tag">&lt;<span class="hljs-title">object</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"GtkScrolledWindow"</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"sidebar-sw"</span>&gt;</span>
                   <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"visible"</span>&gt;</span>True<span class="hljs-tag">&lt;/<span class="hljs-title">property</span>&gt;</span>
                   <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"hscrollbar-policy"</span>&gt;</span>never<span class="hljs-tag">&lt;/<span class="hljs-title">property</span>&gt;</span>
                   <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"vscrollbar-policy"</span>&gt;</span>automatic<span class="hljs-tag">&lt;/<span class="hljs-title">property</span>&gt;</span>
                   <span class="hljs-tag">&lt;<span class="hljs-title">child</span>&gt;</span>
                     <span class="hljs-tag">&lt;<span class="hljs-title">object</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"GtkListBox"</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"words"</span>&gt;</span>
                       <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"visible"</span>&gt;</span>True<span class="hljs-tag">&lt;/<span class="hljs-title">property</span>&gt;</span>
                       <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"selection-mode"</span>&gt;</span>none<span class="hljs-tag">&lt;/<span class="hljs-title">property</span>&gt;</span>
                     <span class="hljs-tag">&lt;/<span class="hljs-title">object</span>&gt;</span>
                   <span class="hljs-tag">&lt;/<span class="hljs-title">child</span>&gt;</span>
                 <span class="hljs-tag">&lt;/<span class="hljs-title">object</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-title">child</span>&gt;</span>
              <span class="hljs-tag">&lt;/<span class="hljs-title">object</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-title">child</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">child</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-title">object</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"GtkStack"</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"stack"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">signal</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"notify::visible-child"</span> <span class="hljs-attribute">handler</span>=<span class="hljs-value">"visible_child_changed"</span>/&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"visible"</span>&gt;</span>True<span class="hljs-tag">&lt;/<span class="hljs-title">property</span>&gt;</span>
              <span class="hljs-tag">&lt;/<span class="hljs-title">object</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-title">child</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-title">object</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">child</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-title">object</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">child</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">template</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">interface</span>&gt;</span>
</code></pre>
<p>The code to populate the sidebar with buttons for the words found in each file is a little too involved to go into here. But we&#39;ll look at the code to add the gears menu.</p>
<p>As expected by now, the gears menu is specified in a GtkBuilder ui file.</p>
<pre><code class="lang-xml"><span class="hljs-pi">&lt;?xml version="1.0"?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">interface</span>&gt;</span>
  <span class="hljs-comment">&lt;!-- interface-requires gtk+ 3.0 --&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">menu</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"menu"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">section</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">item</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">attribute</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"label"</span> <span class="hljs-attribute">translatable</span>=<span class="hljs-value">"yes"</span>&gt;</span>_Words<span class="hljs-tag">&lt;/<span class="hljs-title">attribute</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">attribute</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"action"</span>&gt;</span>win.show-words<span class="hljs-tag">&lt;/<span class="hljs-title">attribute</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-title">item</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">section</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">menu</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">interface</span>&gt;</span>
</code></pre>
<p>To connect the menuitem to the show-words setting, we use a GAction corresponding to the given GSettings key.</p>
<pre><code class="lang-c">...

<span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span>
example_app_window_init (ExampleAppWindow *win)
{

...

  builder = gtk_builder_new_from_resource (<span class="hljs-string">"/org/gtk/exampleapp/gears-menu.ui"</span>);
  menu = G_MENU_MODEL (gtk_builder_get_object (builder, <span class="hljs-string">"menu"</span>));
  gtk_menu_button_set_menu_model (GTK_MENU_BUTTON (priv-&gt;gears), menu);
  g_object_unref (builder);

  action = g_settings_create_action (priv-&gt;settings, <span class="hljs-string">"show-words"</span>);
  g_action_map_add_action (G_ACTION_MAP (win), action);
  g_object_unref (action);
}

...
</code></pre>
<p>(full source)</p>
<p>What our application looks like now:</p>
<p>Properties</p>
<p>Widgets and other objects have many useful properties.</p>
<p>Here we show some ways to use them in new and flexible ways, by wrapping them in actions with GPropertyAction or by binding them with GBinding.</p>
<p>To set this up, we add two labels to the header bar in our window template, named lines_label and lines, and bind them to struct members in the private struct, as we&#39;ve seen a couple of times by now.</p>
<p>We add a new &quot;Lines&quot; menu item to the gears menu, which triggers the show-lines action:</p>
<pre><code class="lang-xml"><span class="hljs-pi">&lt;?xml version="1.0"?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">interface</span>&gt;</span>
  <span class="hljs-comment">&lt;!-- interface-requires gtk+ 3.0 --&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">menu</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"menu"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">section</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">item</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">attribute</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"label"</span> <span class="hljs-attribute">translatable</span>=<span class="hljs-value">"yes"</span>&gt;</span>_Words<span class="hljs-tag">&lt;/<span class="hljs-title">attribute</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">attribute</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"action"</span>&gt;</span>win.show-words<span class="hljs-tag">&lt;/<span class="hljs-title">attribute</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-title">item</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">item</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">attribute</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"label"</span> <span class="hljs-attribute">translatable</span>=<span class="hljs-value">"yes"</span>&gt;</span>_Lines<span class="hljs-tag">&lt;/<span class="hljs-title">attribute</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">attribute</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"action"</span>&gt;</span>win.show-lines<span class="hljs-tag">&lt;/<span class="hljs-title">attribute</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-title">item</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">section</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">menu</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">interface</span>&gt;</span>
</code></pre>
<p>To make this menu item do something, we create a property action for the visible property of the lines label, and add it to the actions of the window. The effect of this is that the visibility of the label gets toggled every time the action is activated.</p>
<p>Since we want both labels to appear and disappear together, we bind the visible property of the lines_label widget to the same property of the lines widget.</p>
<pre><code class="lang-c">...

<span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span>
example_app_window_init (ExampleAppWindow *win)
{
  ...

  action = (GAction*) g_property_action_new (<span class="hljs-string">"show-lines"</span>, priv-&gt;lines, <span class="hljs-string">"visible"</span>);
  g_action_map_add_action (G_ACTION_MAP (win), action);
  g_object_unref (action);

  g_object_bind_property (priv-&gt;lines, <span class="hljs-string">"visible"</span>,
                          priv-&gt;lines_label, <span class="hljs-string">"visible"</span>,
                          G_BINDING_DEFAULT);
}

...
</code></pre>
<p>(full source)</p>
<p>We also need a function that counts the lines of the currently active tab, and updates the lines label. See the full source if you are interested in the details.</p>
<p>This brings our example application to this appearance:</p>
<p>Header bar</p>
<p>Our application already uses a GtkHeaderBar, but so far it still gets a &#39;normal&#39; window titlebar on top of that. This is a bit redundant, and we will now tell GTK+ to use the header bar as replacement for the titlebar. To do so, we move it around to be a direct child of the window, and set its type to be titlebar.</p>
<pre><code class="lang-xml"><span class="hljs-pi">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">interface</span>&gt;</span>
  <span class="hljs-comment">&lt;!-- interface-requires gtk+ 3.8 --&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">template</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"ExampleAppWindow"</span> <span class="hljs-attribute">parent</span>=<span class="hljs-value">"GtkApplicationWindow"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"title"</span> <span class="hljs-attribute">translatable</span>=<span class="hljs-value">"yes"</span>&gt;</span>Example Application<span class="hljs-tag">&lt;/<span class="hljs-title">property</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"default-width"</span>&gt;</span>600<span class="hljs-tag">&lt;/<span class="hljs-title">property</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"default-height"</span>&gt;</span>400<span class="hljs-tag">&lt;/<span class="hljs-title">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">child</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"titlebar"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-title">object</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"GtkHeaderBar"</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"header"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"visible"</span>&gt;</span>True<span class="hljs-tag">&lt;/<span class="hljs-title">property</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"show-close-button"</span>&gt;</span>True<span class="hljs-tag">&lt;/<span class="hljs-title">property</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">child</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-title">object</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"GtkLabel"</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"lines_label"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"visible"</span>&gt;</span>False<span class="hljs-tag">&lt;/<span class="hljs-title">property</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"label"</span> <span class="hljs-attribute">translatable</span>=<span class="hljs-value">"yes"</span>&gt;</span>Lines:<span class="hljs-tag">&lt;/<span class="hljs-title">property</span>&gt;</span>
              <span class="hljs-tag">&lt;/<span class="hljs-title">object</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-title">packing</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"pack-type"</span>&gt;</span>start<span class="hljs-tag">&lt;/<span class="hljs-title">property</span>&gt;</span>
              <span class="hljs-tag">&lt;/<span class="hljs-title">packing</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-title">child</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">child</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-title">object</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"GtkLabel"</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"lines"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"visible"</span>&gt;</span>False<span class="hljs-tag">&lt;/<span class="hljs-title">property</span>&gt;</span>
              <span class="hljs-tag">&lt;/<span class="hljs-title">object</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-title">packing</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"pack-type"</span>&gt;</span>start<span class="hljs-tag">&lt;/<span class="hljs-title">property</span>&gt;</span>
              <span class="hljs-tag">&lt;/<span class="hljs-title">packing</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-title">child</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">child</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"title"</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-title">object</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"GtkStackSwitcher"</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"tabs"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"visible"</span>&gt;</span>True<span class="hljs-tag">&lt;/<span class="hljs-title">property</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"margin"</span>&gt;</span>6<span class="hljs-tag">&lt;/<span class="hljs-title">property</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"stack"</span>&gt;</span>stack<span class="hljs-tag">&lt;/<span class="hljs-title">property</span>&gt;</span>
              <span class="hljs-tag">&lt;/<span class="hljs-title">object</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-title">child</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">child</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-title">object</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"GtkToggleButton"</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"search"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"visible"</span>&gt;</span>True<span class="hljs-tag">&lt;/<span class="hljs-title">property</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"sensitive"</span>&gt;</span>False<span class="hljs-tag">&lt;/<span class="hljs-title">property</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">style</span>&gt;</span><span class="css">
                  &lt;<span class="hljs-tag">class</span> <span class="hljs-tag">name</span>="<span class="hljs-tag">image-button</span>"/&gt;
                </span><span class="hljs-tag">&lt;/<span class="hljs-title">style</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">child</span>&gt;</span>
                  <span class="hljs-tag">&lt;<span class="hljs-title">object</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"GtkImage"</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"search-icon"</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"visible"</span>&gt;</span>True<span class="hljs-tag">&lt;/<span class="hljs-title">property</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"icon-name"</span>&gt;</span>edit-find-symbolic<span class="hljs-tag">&lt;/<span class="hljs-title">property</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"icon-size"</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-title">property</span>&gt;</span>
                  <span class="hljs-tag">&lt;/<span class="hljs-title">object</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-title">child</span>&gt;</span>
              <span class="hljs-tag">&lt;/<span class="hljs-title">object</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-title">packing</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"pack-type"</span>&gt;</span>end<span class="hljs-tag">&lt;/<span class="hljs-title">property</span>&gt;</span>
              <span class="hljs-tag">&lt;/<span class="hljs-title">packing</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-title">child</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">child</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-title">object</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"GtkMenuButton"</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"gears"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"visible"</span>&gt;</span>True<span class="hljs-tag">&lt;/<span class="hljs-title">property</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"direction"</span>&gt;</span>none<span class="hljs-tag">&lt;/<span class="hljs-title">property</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"use-popover"</span>&gt;</span>True<span class="hljs-tag">&lt;/<span class="hljs-title">property</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">style</span>&gt;</span><span class="css">
                  &lt;<span class="hljs-tag">class</span> <span class="hljs-tag">name</span>="<span class="hljs-tag">image-button</span>"/&gt;
                </span><span class="hljs-tag">&lt;/<span class="hljs-title">style</span>&gt;</span>
              <span class="hljs-tag">&lt;/<span class="hljs-title">object</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-title">packing</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"pack-type"</span>&gt;</span>end<span class="hljs-tag">&lt;/<span class="hljs-title">property</span>&gt;</span>
              <span class="hljs-tag">&lt;/<span class="hljs-title">packing</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-title">child</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-title">object</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">child</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">child</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">object</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"GtkBox"</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"content_box"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"visible"</span>&gt;</span>True<span class="hljs-tag">&lt;/<span class="hljs-title">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"orientation"</span>&gt;</span>vertical<span class="hljs-tag">&lt;/<span class="hljs-title">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">child</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-title">object</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"GtkSearchBar"</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"searchbar"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"visible"</span>&gt;</span>True<span class="hljs-tag">&lt;/<span class="hljs-title">property</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">child</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-title">object</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"GtkSearchEntry"</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"searchentry"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">signal</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"search-changed"</span> <span class="hljs-attribute">handler</span>=<span class="hljs-value">"search_text_changed"</span>/&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"visible"</span>&gt;</span>True<span class="hljs-tag">&lt;/<span class="hljs-title">property</span>&gt;</span>
              <span class="hljs-tag">&lt;/<span class="hljs-title">object</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-title">child</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-title">object</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">child</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">child</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-title">object</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"GtkBox"</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"hbox"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"visible"</span>&gt;</span>True<span class="hljs-tag">&lt;/<span class="hljs-title">property</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">child</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-title">object</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"GtkRevealer"</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"sidebar"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"visible"</span>&gt;</span>True<span class="hljs-tag">&lt;/<span class="hljs-title">property</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"transition-type"</span>&gt;</span>slide-right<span class="hljs-tag">&lt;/<span class="hljs-title">property</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">child</span>&gt;</span>
                 <span class="hljs-tag">&lt;<span class="hljs-title">object</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"GtkScrolledWindow"</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"sidebar-sw"</span>&gt;</span>
                   <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"visible"</span>&gt;</span>True<span class="hljs-tag">&lt;/<span class="hljs-title">property</span>&gt;</span>
                   <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"hscrollbar-policy"</span>&gt;</span>never<span class="hljs-tag">&lt;/<span class="hljs-title">property</span>&gt;</span>
                   <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"vscrollbar-policy"</span>&gt;</span>automatic<span class="hljs-tag">&lt;/<span class="hljs-title">property</span>&gt;</span>
                   <span class="hljs-tag">&lt;<span class="hljs-title">child</span>&gt;</span>
                     <span class="hljs-tag">&lt;<span class="hljs-title">object</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"GtkListBox"</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"words"</span>&gt;</span>
                       <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"visible"</span>&gt;</span>True<span class="hljs-tag">&lt;/<span class="hljs-title">property</span>&gt;</span>
                       <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"selection-mode"</span>&gt;</span>none<span class="hljs-tag">&lt;/<span class="hljs-title">property</span>&gt;</span>
                     <span class="hljs-tag">&lt;/<span class="hljs-title">object</span>&gt;</span>
                   <span class="hljs-tag">&lt;/<span class="hljs-title">child</span>&gt;</span>
                 <span class="hljs-tag">&lt;/<span class="hljs-title">object</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-title">child</span>&gt;</span>
              <span class="hljs-tag">&lt;/<span class="hljs-title">object</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-title">child</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">child</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-title">object</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"GtkStack"</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"stack"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">signal</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"notify::visible-child"</span> <span class="hljs-attribute">handler</span>=<span class="hljs-value">"visible_child_changed"</span>/&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"visible"</span>&gt;</span>True<span class="hljs-tag">&lt;/<span class="hljs-title">property</span>&gt;</span>
              <span class="hljs-tag">&lt;/<span class="hljs-title">object</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-title">child</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-title">object</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">child</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-title">object</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">child</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">template</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">interface</span>&gt;</span>
</code></pre>
<p>A small extra bonus of using a header bar is that we get a fallback application menu for free. Here is how the application now looks, if this fallback is used.</p>
<p>If we set up the window icon for our window, the menu button will use that instead of the generic placeholder icon you see here.</p>
<p>Generated by GTK-Doc V1.21.1</p>

                    
                    </section>
                
                </div>
            </div>
        </div>

        
        <a href="../content/building_ui.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page: 构建用户界面"><i class="fa fa-angle-left"></i></a>
        
        
    </div>
</div>

        
<script src="../gitbook/jsrepl/jsrepl.js" id="jsrepl-script"></script>
<script src="../gitbook/app.js"></script>

    
    <script src="http://cdn.mathjax.org/mathjax/2.0-latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-mathjax/plugin.js"></script>
    

<script>
require(["gitbook"], function(gitbook) {
    var config = {};
    gitbook.start(config);
});
</script>

        
    </body>
    
</html>
